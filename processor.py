import os


def get_feature_vector(folder_path: str):
    """
    Features
        - vbaProject.bin size / Full size
        - vbaProject.bin size / word folder size
        - vbaProject.bin size / document.xml size
        - vbaProject.bin + vbaData.xml size / Full size
        - vbaProject.bin + vbaData.xml size / word folder size
        - vbaProject.bin + vbaData.xml size / document.xml size
        - postscript file size / Full size
        - postscript file size / word folder size
        - postscript file size / media folder size
        - _rels folders size / Full size
        - _rels folders size / word folder size
        - _rels folders size / document.xml size
    :param folder_path: target folder to make feature vector(file_bmi)
    :return: vectorized file_bmi
    """
    os.path.basename(folder_path)
    full_size = 0
    word_folder_size = 0
    document_size = 0
    media_size = 0
    vba_project_size = 0
    vba_data_size = 0
    postscript_size = 0
    rels_size = 0
    for path, dirs, files in os.walk(folder_path):
        for file in files:
            full_size += os.path.getsize(path + os.sep + file)
            if file == 'vbaProject.bin':
                vba_project_size += os.path.getsize(path + os.sep + file)
            elif file == 'vbaData.xml':
                vba_data_size += os.path.getsize(path + os.sep + file)
            elif file == 'document.xml':
                document_size += os.path.getsize(path + os.sep + file)
            elif file.count('.eps') != 0:
                postscript_size += os.path.getsize(path + os.sep + file)

    for path, dirs, files in os.walk(folder_path + os.sep + 'word'):
        for file in files:
            word_folder_size += os.path.getsize(path + os.sep + file)

    for path, dirs, files in os.walk(folder_path + os.sep + 'word' + os.sep + '_rels'):
        for file in files:
            rels_size += os.path.getsize(path + os.sep + file)

    for path, dirs, files in os.walk(folder_path + os.sep + 'word' + os.sep + 'media'):
        for file in files:
            media_size += os.path.getsize(path + os.sep + file)

    for path, dirs, files in os.walk(folder_path + os.sep + '_rels'):
        for file in files:
            rels_size += os.path.getsize(path + os.sep + file)

    feature_vector = [
        vba_project_size / word_folder_size,
        vba_project_size / document_size,
        (vba_project_size + vba_data_size) / full_size,
        (vba_project_size + vba_data_size) / word_folder_size,
        (vba_project_size + vba_data_size) / document_size,
        postscript_size / full_size,
        postscript_size / word_folder_size,
        postscript_size / media_size,
        rels_size / full_size,
        rels_size / word_folder_size,
        rels_size / document_size
    ]
    return feature_vector


def main():
    sample_vector = get_feature_vector(r'C:\Users\!\!\Malware_BMI\source\sample')
    for each in sample_vector:
        print(each)


if __name__ == '__main__':
    main()
